#!/bin/bash

BRANCH="$1"
DIR="../$BRANCH"

if [ -z "$BRANCH" ]; then
    echo "âŒ è«‹è¼¸å…¥åˆ†æ”¯åç¨±ï¼šgit add-worktree <branch-name>"
    exit 1
fi

git switch main 2>/dev/null || git checkout main

mkdir -p "$DIR"

if ! git show-ref --quiet refs/heads/$BRANCH; then
    echo "ğŸŒ± å»ºç«‹æ–°åˆ†æ”¯ '$BRANCH' è‡ª main"
    git branch "$BRANCH" main
else
    echo "âœ… åˆ†æ”¯ '$BRANCH' å·²å­˜åœ¨"
fi

if [ -d "$DIR/.git" ]; then
    echo "ğŸ“‚ Worktree '$DIR' å·²å­˜åœ¨"
else
    git worktree add "$DIR" "$BRANCH"
    echo "ğŸš€ Worktree å»ºç«‹æˆåŠŸï¼š$DIR"
fi
